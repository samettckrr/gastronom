<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gastronom</title>
  <style>
    body{margin:0;font-family:system-ui,Arial;background:#0f172a;color:#e5e7eb;display:grid;place-items:center;height:100dvh}
    .card{padding:32px;border-radius:16px;background:rgba(255,255,255,.06);border:1px solid rgba(148,163,184,.2);text-align:center;max-width:520px}
    h1{margin:0 0 8px;font-size:28px}
    p{margin:0 0 16px;opacity:.85}
    small{opacity:.6}
    input,button{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.25);background:rgba(255,255,255,.06);color:#e5e7eb}
    form > div{margin:10px 0}
  </style>
</head>
<body>
  <div class="card">
    <h1>Gastronom</h1>
    <p>Masa • Sipariş • Mutfak — <b>Yakında</b></p>
    <small>© 2025 Gastronom</small>
  </div>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    // ---> KENDİ BİLGİLERİNİ YAPIŞTIR <---
  const SUPABASE_URL  = "https://deiycvkmwiaqzgtyoxmm.supabase.co";
  const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRlaXljdmttd2lhcXpndHlveG1tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwMTg5MzUsImV4cCI6MjA3MjU5NDkzNX0.7Iic2nacxqj2Flusjd4t2HR-8fUHpkmUcLNJs-Nt37I";

    const sb = createClient(SUPABASE_URL, SUPABASE_ANON);

    const card = document.querySelector('.card');

    // Durum yazısı
    const statusEl = document.createElement('div');
    statusEl.style.marginTop = '12px';
    card.appendChild(statusEl);

    async function refreshSession(){
      const { data:{ session } } = await sb.auth.getSession();
      statusEl.textContent = session ? `Girişli: ${session.user.email}` : "Giriş yapılmamış.";
      return !!session;
    }

    // Login formu
    const form = document.createElement('form');
    form.innerHTML = `
      <div><input id="em" type="email" placeholder="E-posta" required></div>
      <div><input id="pw" type="password" placeholder="Şifre" required></div>
      <button>Giriş yap</button>
      <button type="button" id="logout" style="margin-left:8px">Çıkış</button>
    `;
    card.appendChild(form);

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = document.getElementById('em').value.trim();
      const password = document.getElementById('pw').value;
      const { error } = await sb.auth.signInWithPassword({ email, password });
      statusEl.textContent = error ? `Hata: ${error.message}` : "Giriş başarılı.";
      if (!error) listMenu();
    });

    document.getElementById('logout').addEventListener('click', async ()=>{
      await sb.auth.signOut();
      statusEl.textContent = "Çıkış yapıldı.";
      clearMenu();
    });

    // Menü listeleme
    const menuBox = document.createElement('pre');
    menuBox.style.textAlign = 'left';
    function clearMenu(){ menuBox.textContent = ""; }
    async function listMenu(){
      const { data, error } = await sb.from('menu_items').select('name, price').limit(20);
      menuBox.textContent = error ? `Hata: ${error.message}` : JSON.stringify(data, null, 2);
      if (!menuBox.isConnected) card.appendChild(menuBox);
    }

    // Oturum değişince de çalışsın
    sb.auth.onAuthStateChange(async (_event, session)=>{
      if (session) { await listMenu(); }
      else { clearMenu(); }
    });

    // İlk durum
    if (await refreshSession()) { await listMenu(); }
  </script>
</body>
</html>
